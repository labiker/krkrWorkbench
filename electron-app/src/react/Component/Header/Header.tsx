import styles from './Header.module.css';
import SystemMenu from '../SystemMenu/SystemMenu';
import { useState, useEffect } from 'react';
import pngMainIcon from '../../../../public/pngMainIcon.png';
import minimizeAppIcon from '../../../../public/icon/minimizeAppIcon.svg';
import maximizeAppIcon from '../../../../public/icon/maximizeAppIcon.svg';
import unmaximizeAppIcon from '../../../../public/icon/unmaximizeAppIcon.svg';
import closeAppIcon from '../../../../public/icon/closeAppIcon.svg';

// This allows TypeScript to pick up the magic constants that's auto-generated by Forge's Webpack
// plugin that tells the Electron app where to look for the Webpack-bundled app code (depending on
// whether you're running in development or production).
declare const window: Window & { controlProgram: any};

const Header = () => {
    const toMin = () => {
      window.controlProgram.minApp();
    }
    const toMax = () => {
      window.controlProgram.maxApp();
    }
    const toClose = () => {
      window.controlProgram.closeApp();
    }
    const [state, setState] = useState({
      currentMaximizeAppIcon: maximizeAppIcon,
      firstRender: true
    })
    useEffect(()=>{
      if(state.firstRender){
        window.addEventListener('resize', () => {
          const object = document.getElementById('react-app');
          let nextMaximizeAppIcon = maximizeAppIcon;
          if(screen.availHeight === object.clientHeight && screen.availWidth === object.clientWidth){
            nextMaximizeAppIcon = unmaximizeAppIcon;
          }
          if(state.currentMaximizeAppIcon !== nextMaximizeAppIcon){
            setState(() => {
              const nextState = {
                currentMaximizeAppIcon: nextMaximizeAppIcon,
              }
              return {...state, ...nextState};
            });
          }
        });
        setState(() => {
          const nextState = {
            firstRender: false,
          }
          return {...state, ...nextState};
        });
      };
    });
    return (
        /* UI color: #A0E9F9 */
        <div className={styles.header}>
            <img src={pngMainIcon} className={styles.pngSmallIcon} alt='pngSmallIcon' />
            <SystemMenu/>
            <button className={styles.minimizeIcon} onClick={toMin}>
              <img src={minimizeAppIcon} alt='minimizeAppIcon' className={styles.minimizeAppIcon}/>
            </button>
            <button className={styles.maximizeIcon} onClick={toMax}>
              <img src={state.currentMaximizeAppIcon} alt='maximizeAppIcon' className={styles.maximizeAppIcon}/>
            </button>
            <button className={styles.closeIcon} onClick={toClose}>
              <img src={closeAppIcon} alt='closeAppIcon' className={styles.closeAppIcon}/>
            </button>
        </div>
    )
}

export default Header;